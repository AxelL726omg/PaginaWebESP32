function convertirAHoraFormato(hora) {
  // La hora está en formato 'HH:MM' (por ejemplo, '11:00'). La vamos a convertir a 'HHMM' (por ejemplo, '1100').
  const partes = hora.split(':');
  return partes[0].padStart(2, '0') + partes[1].padStart(2, '0');
}

function validarHorariosYPublicar() {
  const regexHora = /^([01]?[0-9]|2[0-3]):([0-5][0-9])$/;
  let errorFormato = false;

  dias.forEach((dia, index) => {
    const manana = document.getElementById(`hora-${index}-manana`).value;
    const tarde = document.getElementById(`hora-${index}-tarde`).value;

    if ((manana && !regexHora.test(manana)) || (tarde && !regexHora.test(tarde))) {
      errorFormato = true;
    }
  });

  if (errorFormato) {
    errorMsg.classList.remove("hidden");
    return;
  }

  errorMsg.classList.add("hidden");

  // Publicar cada horario válido en MQTT
  dias.forEach((dia, index) => {
    const manana = document.getElementById(`hora-${index}-manana`).value;
    const tarde = document.getElementById(`hora-${index}-tarde`).value;

    if (manana) {
      const horaManana = convertirAHoraFormato(manana);
      mqttClient.publish(`dia/${dia}/mañana`, horaManana, {}, (error) => {
        if (error) {
          console.error(`❌ Error al enviar en el topic dia/${dia}/mañana`);
        } else {
          console.log(`✅ Enviado correctamente en el topic dia/${dia}/mañana: ${horaManana}`);
        }
      });
    }
    if (tarde) {
      const horaTarde = convertirAHoraFormato(tarde);
      mqttClient.publish(`dia/${dia}/tarde`, horaTarde, {}, (error) => {
        if (error) {
          console.error(`❌ Error al enviar en el topic dia/${dia}/tarde`);
        } else {
          console.log(`✅ Enviado correctamente en el topic dia/${dia}/tarde: ${horaTarde}`);
        }
      });
    }
  });
}
    enviarBtn.addEventListener("click", validarHorariosYPublicar);
  </script>
</body>
</html>
